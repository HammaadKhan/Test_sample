<?php

$id = $_GET['id'];



$PageTitle = "User";

include_once("./layout/header.php");
include($_SERVER['DOCUMENT_ROOT']. "/include/notified.php");

$stmt = $conn->prepare("SELECT * FROM users WHERE username='$id'");
$stmt->execute();
$users = $stmt->fetch(PDO::FETCH_ASSOC);
// $Verified = VerifiedStatus($users);


if(empty($id = $_GET['id'])){
    header("Location:./404");
    exit;
} 


?>

<main class="pt-[5.5rem] lg:pt-24">
    <!-- Banner -->
    <div class="relative">
        <object data="./assets/front/img/uploads/banner.jpg" type="image/png">
        <img src="./assets/front/img/uploads/<?= $users['user_cover'] ?>" alt="banner"
            class="h-[18.75rem] object-cover" />
            </object>
    </div>
    <!-- end banner -->

    <!-- Profile -->
    <section class="relative bg-light-base pb-12 pt-28 dark:bg-jacarta-800">
        <!-- Avatar -->
        <div class="absolute left-1/2 top-0 z-10 flex -translate-x-1/2 -translate-y-1/2 items-center justify-center">
            <figure class="relative">
                
                <img src="./assets/front/img/uploads/<?= $users['avatar'] ?>" alt="collection avatar"
                    class="rounded-xl border-[5px] border-white dark:border-jacarta-600" width="150" />
                   
            </figure>
        </div>

        <div class="container">
            <div class="text-center">
                <h2 class="mb-2 font-display text-4xl font-medium text-jacarta-700 dark:text-white">
                    <?=$users['username'] ?></h2>
                <div
                    class="mb-8 inline-flex items-center justify-center rounded-full border border-jacarta-100 bg-white py-1.5 px-4 dark:border-jacarta-600 dark:bg-jacarta-700">
                    <span data-tippy-content="ETH">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 1920 1920"
                            xml:space="preserve" class="mr-1 h-4 w-4">
                            <path fill="#8A92B2" d="M959.8 80.7L420.1 976.3 959.8 731z"></path>
                            <path fill="#62688F" d="M959.8 731L420.1 976.3l539.7 319.1zm539.8 245.3L959.8 80.7V731z">
                            </path>
                            <path fill="#454A75" d="M959.8 1295.4l539.8-319.1L959.8 731z"></path>
                            <path fill="#8A92B2" d="M420.1 1078.7l539.7 760.6v-441.7z"></path>
                            <path fill="#62688F" d="M959.8 1397.6v441.7l540.1-760.6z"></path>
                        </svg>
                    </span>
                    <button
                        class="js-copy-clipboard max-w-[10rem] select-none overflow-hidden text-ellipsis whitespace-nowrap dark:text-jacarta-200"
                        data-tippy-content="Copy">
                        <span><?= $users['address']?></span>
                    </button>
                </div>

                <p class="mx-auto mb-2 max-w-xl text-lg dark:text-jacarta-300">
                    <?= $users['bio'];?> </p>
                <span class="text-jacarta-400">Joined <?=$users['createdAt'];?></span>

            </div>
        </div>
    </section>
    <!-- end profile -->

    <!-- Collection -->
    <section class="relative py-24 pt-20">
        <picture class="pointer-events-none absolute inset-0 -z-10 dark:hidden">
            <img src="./assets/front/img/gradient_light.jpg" alt="gradient" class="h-full w-full" />
        </picture>
        <div class="container">
            <!-- Tabs Nav -->
            <ul class="nav nav-tabs scrollbar-custom mb-12 flex items-center justify-start overflow-x-auto overflow-y-hidden border-b border-jacarta-100 pb-px dark:border-jacarta-600 md:justify-center"
                role="tablist">
                <li class="nav-item" role="presentation">
                    <button
                        class="nav-link active relative flex items-center whitespace-nowrap py-3 px-6 text-jacarta-400 hover:text-jacarta-700 dark:hover:text-white"
                        id="on-sale-tab" data-bs-toggle="tab" data-bs-target="#on-sale" type="button" role="tab"
                        aria-controls="on-sale" aria-selected="true">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                            class="mr-1 h-5 w-5 fill-current">
                            <path fill="none" d="M0 0h24v24H0z" />
                            <path
                                d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm1 2v14h16V5H4zm4.5 9H14a.5.5 0 1 0 0-1h-4a2.5 2.5 0 1 1 0-5h1V6h2v2h2.5v2H10a.5.5 0 1 0 0 1h4a2.5 2.5 0 1 1 0 5h-1v2h-2v-2H8.5v-2z" />
                        </svg>
                        <?php 

$allnfts = $conn->query("SELECT * FROM nfts WHERE username='$id' and nft_status='active'");
?>
                        <span class="font-display text-base font-medium">Created (<?= $allnfts->rowCount()?>)</span>

                    </button>
                </li>
                
                <li class="nav-item" role="presentation">
                    <button
                        class="nav-link relative flex items-center whitespace-nowrap py-3 px-6 text-jacarta-400 hover:text-jacarta-700 dark:hover:text-white"
                        id="created-tab" data-bs-toggle="tab" data-bs-target="#created" type="button" role="tab"
                        aria-controls="created" aria-selected="false">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                            class="mr-1 h-5 w-5 fill-current">
                            <path fill="none" d="M0 0h24v24H0z" />
                            <path
                                d="M5 5v3h14V5H5zM4 3h16a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm2 9h6a1 1 0 0 1 1 1v3h1v6h-4v-6h1v-2H5a1 1 0 0 1-1-1v-2h2v1zm11.732 1.732l1.768-1.768 1.768 1.768a2.5 2.5 0 1 1-3.536 0z" />
                        </svg>
                        <?php 

$salenfts = $conn->query("SELECT * FROM nfts WHERE username='$id' and nft_status='sale' order by nfts.asset");
?>
                        <span class="font-display text-base font-medium">On Sale (<?= $salenfts->rowCount()?>)</span>
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <!-- On Sale Tab -->
                <div class="tab-pane fade show active" id="on-sale" role="tabpanel" aria-labelledby="on-sale-tab">

                    <!-- Grid -->
                    <div class="grid grid-cols-1 gap-[1.875rem] md:grid-cols-2 lg:grid-cols-4">
                        <?php
                                

                                $stmt = $conn->prepare("SELECT * FROM nfts INNER JOIN payment ON nfts.payment_id=payment.payment_id WHERE username='$id' and nft_status='active' order by nfts.asset  DESC LIMIT 24");
                            
                                                       
                            
                                                                    $stmt->execute();
                                                                    while($nfts = $stmt->fetch(PDO::FETCH_ASSOC)){
                                        ?>
                        <article>
                            <div
                                class="block rounded-2.5xl border border-jacarta-100 bg-white p-[1.1875rem] transition-shadow hover:shadow-lg dark:border-jacarta-700 dark:bg-jacarta-700">
                                <figure class="relative">
                                    <a href="asset?id=<?= $nfts['asset'] ?>">
                                        <img src="./assets/front/img/products/<?= $nfts['image'] ?>" width="150px"
                                            height="100px" alt="<?= $nfts['nft_name'] ?>" class="w-full rounded-[0.625rem]"
                                            loading="lazy" />
                                    </a>
                                    <div
                                        class="absolute top-3 right-3 flex items-center space-x-1 rounded-md bg-white p-2 dark:bg-jacarta-700">
                                        <span
                                            class="js-likes relative cursor-pointer before:absolute before:h-4 before:w-4 before:bg-[url('../img/heart-fill.svg')] before:bg-cover before:bg-center before:bg-no-repeat before:opacity-0"
                                            data-tippy-content="Favorite">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                                                height="24"
                                                class="h-4 w-4 fill-jacarta-500 hover:fill-red dark:fill-jacarta-200 dark:hover:fill-red">
                                                <path fill="none" d="M0 0H24V24H0z" />
                                                <path
                                                    d="M12.001 4.529c2.349-2.109 5.979-2.039 8.242.228 2.262 2.268 2.34 5.88.236 8.236l-8.48 8.492-8.478-8.492c-2.104-2.356-2.025-5.974.236-8.236 2.265-2.264 5.888-2.34 8.244-.228zm6.826 1.641c-1.5-1.502-3.92-1.563-5.49-.153l-1.335 1.198-1.336-1.197c-1.575-1.412-3.99-1.35-5.494.154-1.49 1.49-1.565 3.875-.192 5.451L12 18.654l7.02-7.03c1.374-1.577 1.299-3.959-.193-5.454z" />
                                            </svg>
                                        </span>
                                        <span class="text-sm dark:text-jacarta-200">15</span>
                                    </div>
                                </figure>
                                <div class="mt-7 flex items-center justify-between">
                                    <a href="asset?id=<?= $nfts['asset'] ?>">
                                        <span
                                            class="font-display text-base text-jacarta-700 hover:text-accent dark:text-white"><?= $nfts['nft_name'] ?></span>
                                    </a>
                                    <div class="dropup rounded-full hover:bg-jacarta-100 dark:hover:bg-jacarta-600">
                                        <a href="#"
                                            class="dropdown-toggle inline-flex h-8 w-8 items-center justify-center text-sm"
                                            role="button" id="itemActions" data-bs-toggle="dropdown"
                                            aria-expanded="false">
                                            <svg width="16" height="4" viewBox="0 0 16 4" fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="fill-jacarta-500 dark:fill-jacarta-200">
                                                <circle cx="2" cy="2" r="2" />
                                                <circle cx="8" cy="2" r="2" />
                                                <circle cx="14" cy="2" r="2" />
                                            </svg>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end z-10 hidden min-w-[200px] whitespace-nowrap rounded-xl bg-white py-4 px-2 text-left shadow-xl dark:bg-jacarta-800"
                                            aria-labelledby="itemActions">
                                            <!-- <button
                                                                    class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                                                    New bid
                                                                </button>
                                                                <hr class="my-2 mx-4 h-px border-0 bg-jacarta-100 dark:bg-jacarta-600" />
                                                                <button
                                                                    class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                                                    Refresh Metadata
                                                                </button> -->
                                            <button
                                                class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                                Share
                                            </button>
                                            <button
                                                class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                                Report
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2 text-sm">
                                    <span class="mr-1 text-jacarta-700 dark:text-jacarta-200">From
                                        <?= $nfts['amount']?> <?=$nfts['short_name']?></span>
                                    <span
                                        class="text-jacarta-500 dark:text-jacarta-300"><?=$nfts['minted'] ?>/<?=$nfts['level'] ?></span>
                                </div>



                                <?php if($nfts['nft_status'] === 'hold' )
{
?>
                     <span class="text-sm dark:text-jacarta-300">Pending Approval</span>

                    <?php }else{ ?>

                    

                    <?php } ?>



                            </div>
                        </article>

                        <?php
                                                                    }
                                            ?>
                    </div>
                    <!-- end grid -->
                </div>
                <!-- end on sale tab -->

              
                <!-- Created Tab -->
                <div class="tab-pane fade" id="created" role="tabpanel" aria-labelledby="created-tab">

                    <!-- Grid -->
                    <div class="grid grid-cols-1 gap-[1.875rem] md:grid-cols-2 lg:grid-cols-4">
                        <?php
                                

    $stmt = $conn->prepare("SELECT * FROM nfts INNER JOIN payment ON nfts.payment_id=payment.payment_id WHERE username='$id' and nft_status='sale' order by nfts.asset DESC LIMIT 24");

                           

                                        $stmt->execute();
                                        while($nfts = $stmt->fetch(PDO::FETCH_ASSOC)){
            ?>
                        <article>
                            <div
                                class="block rounded-2.5xl border border-jacarta-100 bg-white p-[1.1875rem] transition-shadow hover:shadow-lg dark:border-jacarta-700 dark:bg-jacarta-700">
                                <figure class="relative">
                                    <a href="asset?id=<?= $nfts['asset'] ?>">
                                        <img src="./assets/front/img/products/<?= $nfts['cover_image'] ?>"
                                            alt="<?= $nfts['nft_name'] ?>" class="w-full rounded-[0.625rem]"
                                            loading="lazy" />
                                    </a>
                                    <div
                                        class="absolute top-3 right-3 flex items-center space-x-1 rounded-md bg-white p-2 dark:bg-jacarta-700">
                                        <span
                                            class="js-likes relative cursor-pointer before:absolute before:h-4 before:w-4 before:bg-[url('../img/heart-fill.svg')] before:bg-cover before:bg-center before:bg-no-repeat before:opacity-0"
                                            data-tippy-content="Favorite">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                                                height="24"
                                                class="h-4 w-4 fill-jacarta-500 hover:fill-red dark:fill-jacarta-200 dark:hover:fill-red">
                                                <path fill="none" d="M0 0H24V24H0z" />
                                                <path
                                                    d="M12.001 4.529c2.349-2.109 5.979-2.039 8.242.228 2.262 2.268 2.34 5.88.236 8.236l-8.48 8.492-8.478-8.492c-2.104-2.356-2.025-5.974.236-8.236 2.265-2.264 5.888-2.34 8.244-.228zm6.826 1.641c-1.5-1.502-3.92-1.563-5.49-.153l-1.335 1.198-1.336-1.197c-1.575-1.412-3.99-1.35-5.494.154-1.49 1.49-1.565 3.875-.192 5.451L12 18.654l7.02-7.03c1.374-1.577 1.299-3.959-.193-5.454z" />
                                            </svg>
                                        </span>
                                        <span class="text-sm dark:text-jacarta-200">15</span>
                                    </div>
                                </figure>
                                <div class="mt-7 flex items-center justify-between">
                                    <a href="asset?id=<?= $nfts['asset'] ?>">
                                        <span
                                            class="font-display text-base text-jacarta-700 hover:text-accent dark:text-white"><?= $nfts['nft_name'] ?></span>
                                    </a>
                                    <div class="dropup rounded-full hover:bg-jacarta-100 dark:hover:bg-jacarta-600">
                                        <a href="#"
                                            class="dropdown-toggle inline-flex h-8 w-8 items-center justify-center text-sm"
                                            role="button" id="itemActions" data-bs-toggle="dropdown"
                                            aria-expanded="false">
                                            <svg width="16" height="4" viewBox="0 0 16 4" fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="fill-jacarta-500 dark:fill-jacarta-200">
                                                <circle cx="2" cy="2" r="2" />
                                                <circle cx="8" cy="2" r="2" />
                                                <circle cx="14" cy="2" r="2" />
                                            </svg>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-end z-10 hidden min-w-[200px] whitespace-nowrap rounded-xl bg-white py-4 px-2 text-left shadow-xl dark:bg-jacarta-800"
                                            aria-labelledby="itemActions">
                                            <!-- <button
                                        class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                        New bid
                                    </button>
                                    <hr class="my-2 mx-4 h-px border-0 bg-jacarta-100 dark:bg-jacarta-600" />
                                    <button
                                        class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                        Refresh Metadata
                                    </button> -->
                                            <button
                                                class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                                Share
                                            </button>
                                            <button
                                                class="block w-full rounded-xl px-5 py-2 text-left font-display text-sm transition-colors hover:bg-jacarta-50 dark:text-white dark:hover:bg-jacarta-600">
                                                Report
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2 text-sm">
                                    <span class="mr-1 text-jacarta-700 dark:text-jacarta-200">From
                                        <?= $nfts['amount']?> <?=$nfts['short_name']?></span>
                                    <span
                                        class="text-jacarta-500 dark:text-jacarta-300"><?=$nfts['minted'] ?>/<?=$nfts['level'] ?></span>
                                </div>

                            </div>
                        </article>

                        <?php
                                        }
                ?>
                    </div>

                    
                    <!-- end grid -->
                </div>
                <!-- end created tab -->


            </div>
        </div>
    </section>
    <!-- end collection -->


    <?php
  include_once("./layout/footer.php");

  ?>